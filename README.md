# Text Image Mesh Tool

Инструмент для разметки граничных точек на изображениях с текстом, построения криволинейной сетки и визуализации результатов.

## Обзор

Text Image Mesh Tool — это десктопное приложение для разметки и анализа изображений с искривлённым текстом. Инструмент позволяет размечать ключевые точки вдоль границ текста, строить по ним криволинейную сетку и визуализировать результат.

![Режим ввода точек (главная страница)](./images/main_page.png)
*Главная страница (ввод точек): разметка граничных точек, построение сетки, отображение координат и управление режимами.*

![Режим просмотра](./images/view_page.png)
*Режим просмотра: сравнение исходного изображения с сеткой и обработанного изображения с водяным знаком.*

## Функциональные возможности

- Загрузка изображений (PNG, JPG, JPEG, TIF, TIFF)
- Интерактивная разметка граничных точек для 4-х границ (цветовая дифференциация)
- Визуализация введённых точек и координат
- Построение криволинейной сетки по точкам (кубические сплайны)
- Включение/отключение отображения сетки
- Сохранение/загрузка разметки в/из JSON (с координатами, путём к изображению, timestamp)
- Два режима: разметка и просмотр (сравнение исходного и обработанного изображения, водяной знак)
- Удобная навигация между режимами, сохранение состояния
### Сохранение и загрузка
- **Сохранение разметки** в JSON-файл:
```
points.json
```
  ```json
  {
      "points": {
          "edge_top": [[x1, y1], [x2, y2], ...],
          "edge_bottom": [[x1, y1], [x2, y2], ...],
          "edge_left": [[x1, y1], [x2, y2], ...],
          "edge_right": [[x1, y1], [x2, y2], ...]
      },
      "image_path": "путь/к/исходному/изображению",
      "timestamp": "2025-05-11T21:45:00.000Z"
  }
  ```
- **Загрузка сохранённой разметки** с автоматическим восстановлением точек
- **Автоматическое масштабирование координат** между локальным отображением и исходным изображением

## Структура проекта

```
text-image-tool/
├── app.py             # Точка входа, запуск приложения, маршрутизация страниц
├── core/              # Ядро приложения (математика, построение сетки)
│   └── utils.py       # Алгоритмы построения сетки, обработка точек
├── ui/                # Пользовательский интерфейс (UI)
│   ├── main_page.py   # Страница разметки точек и управления
│   ├── view_page.py   # Страница просмотра результатов
│   ├── components/    # Мелкие UI-компоненты (см. ниже)
│   │   ├── image_display.py   # Отображение изображения, добавление точек, наложение сетки
│   │   └── control_panel.py   # Панель управления: выбор границы, кнопки, чекбокс, координаты
│   ├── handlers/      # Обработчики событий (см. ниже)
│   │   ├── image_handlers.py  # Загрузка/обработка изображений, алерты
│   │   └── grid_handlers.py   # Построение сетки, взаимодействие с core
│   ├── state/         # Управление состоянием приложения
│   │   └── app_state.py       # Класс AppState: точки, границы, флаги, путь к изображению, canvas
│   └── utils/         # Вспомогательные функции для UI
│       ├── file_utils.py      # Работа с файлами разметки (JSON)
│       └── image_utils.py     # Вспомогательные функции для изображений
├── images/            # Скриншоты для документации
└── storage/           # Временное хранилище файлов пользователя
```

### Взаимодействие компонентов

- `app.py` — связывает страницы, управляет навигацией, инициализирует приложение.
- `ui/main_page.py` и `ui/view_page.py` — реализуют страницы, используют компоненты из `components/`, обрабатывают события через `handlers/`, всё состояние хранится в экземпляре `AppState` (`state/`).
- `core/utils.py` — вызывается из обработчиков для построения сетки.
- `components/image_display.py` и `components/control_panel.py` — напрямую работают с состоянием, обновляют UI, реагируют на действия пользователя.

### Краткое описание подпапок UI

- **components/** — отдельные визуальные элементы (отображение изображения, панель управления, чекбоксы, поля координат и др.).
- **handlers/** — обработчики событий (загрузка изображений, построение сетки, алерты, взаимодействие с core).
- **state/** — хранение и управление состоянием приложения (текущие точки, выбранная граница, флаги, путь к изображению, canvas сетки).
- **utils/** — вспомогательные функции для работы с файлами и изображениями.

## Пример сценария использования

1. **Загрузите изображение** через кнопку "Загрузить изображение".
2. **Выберите границу** (верх, низ, лево, право) в выпадающем списке.
3. **Добавьте точки** кликами по изображению (минимум 2 на каждую границу).
4. **Постройте сетку** — кнопка "Построить сетку". Сетка появится поверх изображения.
5. **Включите/выключите сетку** чекбоксом "Показать сетку".
6. **Сохраните разметку** или загрузите ранее сохранённую.
7. **Перейдите в режим просмотра** — кнопка "Применить". Слева — исходное изображение с сеткой, справа — изображение с водяным знаком.
8. **Вернитесь назад** для редактирования.

*См. скриншоты выше для визуального примера интерфейса и работы приложения.*

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/trxxnk/text-image-tool.git
   cd text-image-tool
   ```
2. Создайте виртуальное окружение и активируйте его:
   ```bash
   python -m venv venv
   venv\Scripts\activate  # Windows
   # или
   source venv/bin/activate  # Linux/Mac
   ```
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите приложение:
   ```bash
   python app.py
   ```

## Технические особенности

- **Фреймворк интерфейса**: Flet (Flutter + Python)
- **Обработка изображений**: OpenCV и NumPy
- **Построение сетки**: Кубические сплайны (`scipy`) и векторизованные расчёты (`numpy`)
- **Архитектура**: Модульная структура с разделением логики и представления

## Ограничения

- **Web-режим**: В браузере загрузка локальных изображений может не работать из-за ограничений доступа. Рекомендуется использовать десктопную версию.
- **Точность сетки**: Качество построенной сетки зависит от количества и расположения точек.
- **Обработка введенных точек**: Верхние угловые точки должны быть занесены в `edge_top`, аналогично нижние угловые точки в `edge_bottom`. Необходимо реализовать более умную систему обработки введенных точек.
- **Подсказки, уведомления, исключительные ситуации**: В коде предусмотрены некоторые простые обработчики исключительных ситуаций, однако в большинстве случаев информация об ошибках <u>не выводится</u> пользователю.

## Планы развития

- Редактирование точек (удаление, перемещение)
- Алгоритм выпрямления изображения
- Пакетная обработка
- Настройка параметров сетки

## Вклад в проект

Приветствуются предложения по улучшению и исправлению ошибок! Для внесения изменений:
1. Создайте форк репозитория
2. Создайте ветку для ваших изменений (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add some amazing feature'`)
4. Отправьте изменения в ваш форк (`git push origin feature/amazing-feature`)
5. Создайте Pull Request

## Контакты

При возникновении вопросов или предложений, пожалуйста, создайте Issue в репозитории проекта. 